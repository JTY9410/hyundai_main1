{% extends 'base.html' %}
{% block title %}회원가입승인{% endblock %}
{% block content %}
<div class="mb-4 flex flex-wrap gap-2 items-center">
  <a href="{{ url_for('admin_home') }}" class="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200"><i class="bi bi-arrow-left mr-2"></i>관리자페이지로</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
  <div class="bg-white shadow-md rounded-lg p-4">
    <h5 class="text-lg font-semibold text-gray-800 mb-3">회원추가</h5>
    <form method="post" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-2 gap-3" id="create-member-form">
      <input type="hidden" name="action" value="create">
      
      <!-- 파트너그룹 선택 -->
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-building mr-2 text-blue-500"></i>파트너그룹 선택 <span class="text-red-500">*</span>
        </label>
        <select name="partner_group_id" required
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option value="">가입할 파트너그룹을 선택하세요</option>
          {% for group in partner_groups %}
          <option value="{{ group.id }}">{{ group.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- 법인/개인 선택 -->
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-person-check mr-2 text-blue-500"></i>회원 유형 <span class="text-red-500">*</span>
        </label>
        <div class="flex gap-6">
          <label class="flex items-center cursor-pointer">
            <input type="radio" name="member_type" value="법인" checked class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" onchange="togglePrivacyAgreement()">
            <span class="ml-2 text-sm font-medium text-gray-700">법인</span>
          </label>
          <label class="flex items-center cursor-pointer">
            <input type="radio" name="member_type" value="개인" class="w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500" onchange="togglePrivacyAgreement()">
            <span class="ml-2 text-sm font-medium text-gray-700">개인</span>
          </label>
        </div>
      </div>

      <!-- 개인정보이용동의 (개인 선택 시에만 표시) -->
      <div id="privacy-agreement-section" class="md:col-span-2 hidden">
        <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4">
          <label class="flex items-start cursor-pointer">
            <input type="checkbox" name="privacy_agreement" id="privacy_agreement"
                   class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
            <div class="ml-3 flex-1">
              <span class="text-sm font-semibold text-gray-700">
                개인정보 수집 및 이용에 대한 동의
              </span>
              <p class="text-xs text-gray-600 mt-1">
                개인 회원가입을 위해 개인정보 수집 및 이용에 동의가 필요합니다.
              </p>
            </div>
          </label>
        </div>
      </div>

      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-person mr-2 text-blue-500"></i>아이디<span class="text-red-500">*</span>
        </label>
        <input type="text" name="username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-lock mr-2 text-blue-500"></i>비밀번호<span class="text-red-500">*</span>
        </label>
        <input type="password" name="password" placeholder="미입력시 temp1234" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-building mr-2 text-blue-500"></i>상사명<span class="text-red-500">*</span>
        </label>
        <input type="text" name="company_name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-geo-alt mr-2 text-blue-500"></i>주소
        </label>
        <input type="text" name="address" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-card-text mr-2 text-blue-500"></i>사업자번호<span class="text-red-500">*</span>
        </label>
        <input type="text" name="business_number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-file-earmark-text mr-2 text-blue-500"></i>법인번호
        </label>
        <input type="text" name="corporation_number" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-person-badge mr-2 text-blue-500"></i>대표자
        </label>
        <input type="text" name="representative" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-telephone mr-2 text-blue-500"></i>연락처
        </label>
        <input type="text" name="phone" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-phone mr-2 text-blue-500"></i>휴대폰
        </label>
        <input type="text" name="mobile" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-envelope mr-2 text-blue-500"></i>이메일
        </label>
        <input type="email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
      </div>
      
      <!-- 사업자등록증 첨부 -->
      <div class="md:col-span-2">
        <label class="block text-sm text-gray-700 font-semibold mb-1">
          <i class="bi bi-paperclip mr-2 text-blue-500"></i>사업자등록증 첨부 (선택)
        </label>
        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors duration-200" id="file-upload-area">
          <div class="space-y-1 text-center">
            <i class="bi bi-cloud-upload text-3xl text-gray-400" id="upload-icon"></i>
            <div class="flex text-sm text-gray-600">
              <label for="file-upload-create" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500">
                <span>파일 선택</span>
                <input id="file-upload-create" name="registration_cert" type="file" class="sr-only" accept=".pdf,.jpg,.jpeg,.png">
              </label>
              <p class="pl-1">또는 드래그하여 놓기</p>
            </div>
            <p class="text-xs text-gray-500" id="file-info">PDF, JPG, PNG 파일 (최대 10MB)</p>
            <p class="text-xs text-blue-600 font-medium hidden" id="selected-file"></p>
          </div>
        </div>
      </div>

      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">승인상태</label>
        <select name="approval_status" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option value="신청">신청</option>
          <option value="승인중">승인중</option>
          <option value="승인" selected>승인</option>
        </select>
      </div>
      <div>
        <label class="block text-sm text-gray-700 font-semibold mb-1">권한</label>
        <select name="role" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option value="member" selected>회원</option>
          <option value="admin">관리자</option>
        </select>
      </div>
      <div class="md:col-span-2 flex justify-end">
        <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">회원추가</button>
      </div>
    </form>
  </div>
  <div class="bg-white shadow-md rounded-lg p-4">
    <h5 class="text-lg font-semibold text-gray-800 mb-3">회원 일괄 업로드</h5>
    <div class="mb-2 text-sm text-gray-600">필수 컬럼: username, company_name, business_number / 선택 컬럼: password, address, corporation_number, representative, phone, mobile, email, approval_status</div>
    <form action="{{ url_for('admin_members_upload') }}" method="post" enctype="multipart/form-data" class="flex items-center gap-2">
      <input type="file" name="file" accept=".xlsx,.xls" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" required>
      <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">일괄업로드</button>
    </form>
  </div>
</div>

<div class="bg-white shadow-md rounded-lg p-6">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 sticky-header table-auto">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[50px]">순</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[120px]">상사명</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[200px]">주소</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[120px]">사업자번호</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[120px]">법인번호</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[100px]">대표자</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[110px]">연락처</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[110px]">휴대폰</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[180px]">이메일</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[90px]">승인</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[80px]">권한</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[120px]">사업자등록증</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[150px]">비고</th>
          <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky top-0 bg-gray-50 z-10 min-w-[120px]">작업</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for m in members %}
          <tr>
            <td class="px-4 py-2 whitespace-nowrap">{{ loop.index }}</td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="company_name" class="form-input block w-full text-sm" value="{{ m.company_name }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.company_name }}
              {% endif %}
            </td>
            <td class="px-4 py-2 text-sm break-words">
              {% if edit_id == m.id|string %}
                <input type="text" name="address" class="form-input block w-full text-sm" value="{{ m.address or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.address or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">{{ m.business_number }}</td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="corporation_number" class="form-input block w-full text-sm" value="{{ m.corporation_number or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.corporation_number or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="representative" class="form-input block w-full text-sm" value="{{ m.representative or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.representative or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="phone" class="form-input block w-full text-sm" value="{{ m.phone or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.phone or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <input type="text" name="mobile" class="form-input block w-full text-sm" value="{{ m.mobile or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.mobile or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 text-sm break-all">
              {% if edit_id == m.id|string %}
                <input type="email" name="email" class="form-input block w-full text-sm" value="{{ m.email or '' }}" form="edit_form_{{ m.id }}">
              {% else %}
                {{ m.email or '' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <select name="approval_status" class="form-select block w-full text-sm" form="edit_form_{{ m.id }}">
                  <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                  <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                  <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                </select>
              {% else %}
                <form method="post" class="inline-block">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <select name="approval_status" class="form-select block w-full text-sm" onchange="this.form.submit()">
                    <option value="신청" {% if m.approval_status == '신청' %}selected{% endif %}>신청</option>
                    <option value="승인중" {% if m.approval_status == '승인중' %}selected{% endif %}>승인중</option>
                    <option value="승인" {% if m.approval_status == '승인' %}selected{% endif %}>승인</option>
                  </select>
                  <input type="hidden" name="action" value="update_status">
                </form>
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <select name="role" class="form-select block w-full text-sm" form="edit_form_{{ m.id }}">
                  <option value="member" {% if (m.role or 'member') == 'member' %}selected{% endif %}>회원</option>
                  <option value="admin" {% if m.role == 'admin' %}selected{% endif %}>관리자</option>
                </select>
              {% else %}
                {{ '관리자' if m.role == 'admin' else '회원' }}
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap text-center">
              {% if edit_id == m.id|string %}
                <div class="space-y-2">
                  {% if m.registration_cert_path %}
                    <div class="text-xs text-gray-600 mb-1">
                      <a href="{{ url_for('uploaded_file', filename=m.registration_cert_path.split('/')[-1]) }}" 
                         class="text-blue-600 hover:text-blue-800 underline">
                        현재 파일 보기
                      </a>
                    </div>
                  {% endif %}
                  <input type="file" name="registration_cert" accept=".pdf,.jpg,.jpeg,.png" 
                         class="block w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                         form="edit_form_{{ m.id }}">
                  <p class="text-xs text-gray-400">PDF, JPG, PNG (최대 10MB)</p>
                </div>
              {% else %}
                {% if m.registration_cert_path %}
                  <a href="{{ url_for('uploaded_file', filename=m.registration_cert_path.split('/')[-1]) }}" 
                     class="inline-flex items-center px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium rounded-md transition-colors duration-200"
                     title="{{ m.registration_cert_path.split('/')[-1] }}">
                    <i class="bi bi-file-earmark-pdf mr-1"></i>
                    보기
                  </a>
                {% else %}
                  <span class="text-gray-400 text-xs">미첨부</span>
                {% endif %}
              {% endif %}
            </td>
            <td class="px-4 py-2 text-sm break-words">
              {% if edit_id == m.id|string %}
                <input type="text" name="memo" class="form-input block w-full text-sm" value="" form="edit_form_{{ m.id }}" placeholder="비고 입력">
              {% else %}
                <input type="text" name="memo" class="form-input block w-full text-sm" value="" placeholder="비고 입력" readonly class="bg-gray-100 cursor-not-allowed">
              {% endif %}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {% if edit_id == m.id|string %}
                <form id="edit_form_{{ m.id }}" method="post" enctype="multipart/form-data" class="inline-flex space-x-2">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="save">
                  <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">저장</button>
                  <a href="{{ url_for('admin_members') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">취소</a>
                </form>
              {% else %}
                <a href="{{ url_for('admin_members', edit_id=m.id) }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">수정</a>
                <form method="post" class="inline-block ml-2" onsubmit="return confirm('삭제하시겠습니까?')">
                  <input type="hidden" name="member_id" value="{{ m.id }}">
                  <input type="hidden" name="action" value="delete">
                  <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">삭제</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function togglePrivacyAgreement() {
  const memberType = document.querySelector('input[name="member_type"]:checked');
  const privacySection = document.getElementById('privacy-agreement-section');
  const privacyCheckbox = document.getElementById('privacy_agreement');
  
  if (memberType && memberType.value === '개인') {
    if (privacySection) {
      privacySection.classList.remove('hidden');
    }
    if (privacyCheckbox) {
      privacyCheckbox.required = true;
    }
  } else {
    if (privacySection) {
      privacySection.classList.add('hidden');
    }
    if (privacyCheckbox) {
      privacyCheckbox.required = false;
      privacyCheckbox.checked = false;
    }
  }
}

// 파일 업로드 처리
function handleFileSelect(file) {
  const fileInfo = document.getElementById('file-info');
  const selectedFile = document.getElementById('selected-file');
  const uploadArea = document.getElementById('file-upload-area');
  const uploadIcon = document.getElementById('upload-icon');
  
  if (file) {
    const fileName = file.name;
    const fileSize = (file.size / 1024 / 1024).toFixed(2); // MB
    const fileExt = fileName.split('.').pop().toLowerCase();
    const allowedExts = ['pdf', 'jpg', 'jpeg', 'png'];
    
    if (!allowedExts.includes(fileExt)) {
      alert('PDF, JPG, PNG 파일만 업로드 가능합니다.');
      document.getElementById('file-upload-create').value = '';
      return;
    }
    
    if (file.size > 10 * 1024 * 1024) { // 10MB
      alert('파일 크기는 10MB를 초과할 수 없습니다.');
      document.getElementById('file-upload-create').value = '';
      return;
    }
    
    selectedFile.textContent = `선택된 파일: ${fileName} (${fileSize} MB)`;
    selectedFile.classList.remove('hidden');
    uploadArea.classList.add('border-blue-500', 'bg-blue-50');
    uploadIcon.classList.remove('text-gray-400');
    uploadIcon.classList.add('text-blue-500');
  }
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
  // 초기 상태 설정
  togglePrivacyAgreement();
  
  // 파일 업로드 이벤트 리스너
  const fileInput = document.getElementById('file-upload-create');
  if (fileInput) {
    fileInput.addEventListener('change', function(e) {
      if (e.target.files && e.target.files[0]) {
        handleFileSelect(e.target.files[0]);
      }
    });
  }
  
  // 드래그 앤 드롭 이벤트
  const uploadArea = document.getElementById('file-upload-area');
  if (uploadArea) {
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      e.stopPropagation();
      this.classList.add('border-blue-500', 'bg-blue-50');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      e.stopPropagation();
      this.classList.remove('border-blue-500', 'bg-blue-50');
    });
    
    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      e.stopPropagation();
      this.classList.remove('border-blue-500', 'bg-blue-50');
      
      if (e.dataTransfer.files && e.dataTransfer.files[0]) {
        const fileInput = document.getElementById('file-upload-create');
        fileInput.files = e.dataTransfer.files;
        handleFileSelect(e.dataTransfer.files[0]);
      }
    });
  }
  
  // 폼 제출 전 검증
  const createForm = document.getElementById('create-member-form');
  if (createForm) {
    createForm.addEventListener('submit', function(e) {
      const memberType = document.querySelector('input[name="member_type"]:checked');
      if (memberType && memberType.value === '개인') {
        const privacyCheckbox = document.getElementById('privacy_agreement');
        if (privacyCheckbox && !privacyCheckbox.checked) {
          e.preventDefault();
          alert('개인 회원가입 시 개인정보이용동의서에 동의해주세요.');
          privacyCheckbox.focus();
          return false;
        }
      }
      return true;
    });
  }
});
</script>
{% endblock %}


